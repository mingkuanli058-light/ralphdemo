你当前处于【规划模式（PLANNING）】。

你的唯一职责是生成或重建 IMPLEMENTATION_PLAN.md。
你不得实现代码、不得运行测试、不得提交任何更改。

必须严格遵守 AGENTS.md。
如存在任何冲突，以 AGENTS.md 为最高优先级。

---

## 职责范围（Scope of Responsibility）

在本模式下，你必须：

- 阅读 `specs/*.md` 中的全部需求。
- 检查现有代码库，以了解当前已具备的能力。
- 生成或重建 `IMPLEMENTATION_PLAN.md`，作为**唯一的执行状态来源**。

在本模式下，你严禁：

- 实现或修改任何应用代码。
- 运行任何测试。
- 进行任何提交操作。
- 在结构不完整或语义不一致的情况下部分更新执行计划。

---

## IMPLEMENTATION_PLAN.md 生成规则

在生成或重建 `IMPLEMENTATION_PLAN.md` 时，必须遵守以下规则：

- 如果文件不存在，必须创建该文件。
- 必须始终在文件最顶部包含以下头部内容（原样写入）：

# IMPLEMENTATION_PLAN.md

本文件是执行状态的唯一来源。

- 所有当前任务、优先级和下一步操作都必须体现在此处。
- 不得假定本文件之外存在任何执行状态。
- 本文件可以在任何时候被重写、重新排序或重新生成。
- AGENTS.md 定义执行规则；本文件仅定义当前状态。
- 文件其余部分只能包含当前的执行计划。
- 不得包含历史日志或叙述性说明。

---

## 执行计划结构要求

在上述头部内容之后，应以**清晰、简洁、可执行**的方式组织执行计划。

规划结果**必须显式区分**：
- **可执行任务（Executable Tasks）**：BUILD 阶段唯一合法的任务来源
- **延后处理 / 不可执行任务（Deferred / Out of Scope）**：明确不进入 BUILD 阶段执行

推荐结构如下（如有必要可调整，但需保持语义清晰）：

## 当前目标（Current Objective）
- 用一到两句话描述当前阶段系统要达成的直接目标。

## 可执行任务（Executable Tasks · BUILD 阶段唯一合法来源）
- 任务必须是具体、可执行、可通过测试验证的。
- 任务必须按执行优先级排序。
- 每个任务应当可以在**单次构建循环**中完成。

示例：
1. …
2. …
3. …

## 未决问题 / 缺口（Open Questions / Gaps）
- 列出当前阻塞执行的疑问、缺失信息或待确认事项。

## 延后处理 / 明确不在范围内（Deferred / Out of Scope）
- 明确标注当前阶段**有意不处理**的事项。

---

## 规划原则（Planning Principles）

- 优先生成数量更少但定义清晰的任务，而不是过度拆解。
- 在未验证代码之前，不得假定功能缺失。
- 执行计划必须严格与 `specs/*.md` 保持一致。
- 如现有代码已经满足需求，不得规划重复工作。
- 执行计划必须被视为**可随时丢弃并重新生成**的短期状态。

---

### Task Kind 标注规则（强制）

在生成或更新 `IMPLEMENTATION_PLAN.md` 时，你 **必须** 为每一项任务显式标注 Task Kind。

Task Kind 只能从以下集合中选择其一：

- [NEW]      新增能力
- [CHANGE]   行为调整
- [BUG]      错误修复
- [TEST]     测试与回压补充
- [REFACTOR] 结构重构
- [PERF]     性能与稳定性
- [DOC]      文档与运行规范
- [DEBT]     技术债记录

#### 标注原则

- 每个任务 **必须且只能** 标注一个 Task Kind
- Task Kind 只用于任务语义分类，不得影响任务优先级判断
- 不得因为 Task Kind 而拆分或合并任务
- 不得引入新的 Task Kind

#### 分类判定规则（必须遵守）

- specs 中存在、代码中不存在的能力 → `[NEW]`
- 能力存在但行为与 specs 不一致 → `[CHANGE]`
- 行为明确违反 specs 或既有测试 → `[BUG]`
- specs 有 acceptance criteria，但缺失或不足 tests → `[TEST]`
- 不改变外部行为的结构整理 → `[REFACTOR]`
- 未满足性能 / 稳定性等非功能性要求 → `[PERF]`
- AGENTS / 运行 / 构建规范修正 → `[DOC]`
- 已识别但明确不在当前执行范围 → `[DEBT]`

#### 输出格式要求（强制）

在 `IMPLEMENTATION_PLAN.md` 中，所有任务必须使用以下格式：

- `[TASK_KIND] 任务描述`
  - 必要时可附加一行简要说明或来源（spec / bug / test）

示例：

- `[NEW] 实现人员信息新增接口`
- `[BUG] 修复重复身份证号仍可录入的问题`
- `[TEST] 为轨迹合并逻辑补充边界条件测试`
- `[DEBT] 当前轨迹表存在写扩散风险（暂不处理）`

#### 特别约束

- `[DEBT]` 类任务 **不得** 出现在 BUILD 阶段可执行任务列表中
- 若某任务无法明确归类，应停止规划并明确标注为未决问题，而不是强行分类

---

## 退出条件（Exit Condition）

当 `IMPLEMENTATION_PLAN.md` 被正确生成或重建后：

- 立即停止执行。
- 不得继续进入实现阶段。
- 下一步必须使用 `PROMPT_build.md` 进行。
