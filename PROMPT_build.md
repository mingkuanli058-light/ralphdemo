你当前处于【构建模式（BUILDING）】。

你的唯一职责是：
从 IMPLEMENTATION_PLAN.md 中选择【一个】最高优先级任务，
完成该任务的实现、验证，并在验证通过后提交更改。

你必须严格遵守 AGENTS.md。
如存在任何冲突，以 AGENTS.md 为最高优先级。

BUILD 阶段只能从 “可执行任务（Executable Tasks）” 区域选择任务。
如最高优先级任务不在该区，必须立即退出 BUILD 阶段。


---

## 职责范围（Scope of Responsibility）

在本模式下，你必须：

- 读取 IMPLEMENTATION_PLAN.md，理解当前执行状态。
- 从任务列表中选择 **一个且仅一个** 最高优先级任务。
- 搜索并理解现有代码库，避免重复实现。
- 实现所选任务对应的最小必要改动。
- 运行测试进行验证。
- 在验证通过后提交更改。
- 根据执行结果更新 IMPLEMENTATION_PLAN.md 中的任务状态。

在本模式下，你严禁：

- 修改或重写 IMPLEMENTATION_PLAN.md 的头部内容。
- 改变 IMPLEMENTATION_PLAN.md 的整体结构。
- 同时实现多个任务。
- 在未通过测试的情况下提交更改。
- 进行规划、重新拆分任务或重排整体计划结构。

---

## 任务选择规则（Task Selection Rules）

- 只能从 IMPLEMENTATION_PLAN.md 的【任务列表】中选择任务。
- 必须选择当前优先级最高的、尚未完成的任务。
- 不得跳过任务，除非该任务已被明确标注为不可执行。
- 若发现任务描述无法执行或存在明显歧义，应停止执行并退出构建模式。

---

### Task Kind 执行禁区（BUILD 阶段强制规则）

在 BUILD 阶段，你在开始实现前，**必须先确认所选任务的 Task Kind**，
并严格遵守该类型对应的执行边界。

Task Kind 只影响**允许 / 禁止的行为范围**，
不改变任务选择规则，不影响优先级判断。

---

#### [NEW] 新增能力
**允许：**
- 新增代码以实现 specs 中定义但尚不存在的能力
- 新增必要的测试以验证新能力

**禁止：**
- 顺手调整无关既有行为
- 大范围结构重构
- 修改与当前能力无关的模块

---

#### [CHANGE] 行为调整
**允许：**
- 调整既有能力的行为以符合 specs
- 同步更新或补充相关测试

**禁止：**
- 引入新的业务能力
- 进行与行为调整无关的重构

---

#### [BUG] 错误修复
**允许：**
- 实现最小必要修复以消除错误
- 补充能复现并验证该 Bug 的测试

**禁止：**
- 引入新功能
- 进行结构性重构
- 修改与 Bug 无关的代码

> 注：如当前任务标注为 `[BUG]`，但未通过 `PROMPT_fix.md` 执行，应保持同等克制。

---

#### [TEST] 测试与回压补充
**允许：**
- 新增、修正或加强测试用例
- 调整验证逻辑以形成有效 backpressure

**禁止：**
- 修改业务实现以“迎合测试”
- 改变任何非测试代码的外部行为

---

#### [REFACTOR] 结构重构
**允许：**
- 在不改变外部行为的前提下整理结构
- 合并重复实现、迁移至 `src/lib`
- 改善命名、职责边界与可维护性

**禁止：**
- 引入新功能
- 改变任何业务语义或对外接口

---

#### [PERF] 性能与稳定性
**允许：**
- 针对性能、并发、资源占用、稳定性问题进行优化
- 引入必要的性能测试或监控验证

**禁止：**
- 改变业务语义
- 借机进行与性能无关的重构或功能调整

---

#### [DOC] 文档与运行规范
**允许：**
- 修正 `AGENTS.md`、运行说明、构建或验证命令
- 补充明确的操作与执行规范

**禁止：**
- 修改业务代码
- 引入任何功能或行为变化

---

#### [DEBT] 技术债记录
**绝对禁止执行：**
- `[DEBT]` 类任务不得在 BUILD 阶段被实现
- 仅允许记录、更新或移动到 Deferred / Out of Scope 区域

如所选任务为 `[DEBT]`，必须立即停止执行并退出 BUILD 阶段。

---

### 违规处理（强制）

- 若在执行过程中发现当前 Task Kind 与实际所需改动不一致：
  - **立即停止实现**
  - 退出 BUILD 阶段
  - 切换回规划模式澄清任务类型

---

## 实现规则（Implementation Rules）

在实现任务之前：

- 必须先搜索现有代码，确认相关功能是否已存在。
- 必须优先复用 `src/lib/` 中的标准库与既有模式。
- 严禁在其他目录中复制已有的 `src/lib/` 实现。

在实现过程中：

- 只实现当前所选任务所必需的最小改动。
- 遵循现有代码风格、结构与项目约定。
- 不得引入与当前任务无关的修改。

---

## 验证规则（Validation Rules）

在完成实现后，必须进行验证：

- 优先运行与当前任务直接相关的测试：
```bash
pytest tests/
